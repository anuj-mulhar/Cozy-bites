<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fooddial Sign Up</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(to bottom, #dcd0c0, #bfaea2);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
        }
        .card-shadow { box-shadow: 0 35px 60px -15px rgba(0, 0, 0, 0.1); }
        .text-brown { color: #5D4037; }
        .bg-cream { background-color: #FFF8F0; }
        .bg-terracotta { background-color: #C26D4F; }
        .text-terracotta { color: #C26D4F; }
        .bg-input { background-color: #EFE6D8; }
        .placeholder-brown::placeholder { color: #8D7A73; }
    </style>
</head>

<body class="p-4 sm:p-8">

    <div class="relative w-full max-w-md bg-cream rounded-[40px] p-6 sm:p-10 flex flex-col items-center card-shadow h-auto min-h-[650px] justify-between">

        <div class="absolute top-10 w-full flex flex-col items-center">
            <i class="fa-solid fa-bowl-food text-3xl text-brown mb-2 opacity-80"></i>
            <h1 class="text-3xl sm:text-4xl font-bold text-brown tracking-wide text-center">Fooddial</h1>
        </div>

        <div class="bg-white w-full rounded-[30px] p-6 sm:p-8 shadow-lg flex flex-col gap-5 mt-20">
            
            <h2 class="text-xl sm:text-2xl font-bold text-brown text-center mb-2">Create Your Account</h2>
            
            <div id="messageBox" class="hidden p-3 rounded-xl text-center text-sm font-bold"></div>

            <div class="relative group">
                <i class="fa-solid fa-user absolute left-4 top-1/2 -translate-y-1/2 text-brown opacity-60 text-lg group-focus-within:text-terracotta transition-colors"></i>
                <input type="text" id="signupName" placeholder="Full Name" class="w-full py-4 pl-12 pr-4 bg-input rounded-2xl text-brown font-semibold placeholder-brown outline-none focus:ring-2 focus:ring-terracotta transition-all">
            </div>

            <div class="relative group">
                <i class="fa-solid fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-brown opacity-60 text-lg group-focus-within:text-terracotta transition-colors"></i>
                <input type="email" id="signupEmail" placeholder="Email (Gmail only)" class="w-full py-4 pl-12 pr-4 bg-input rounded-2xl text-brown font-semibold placeholder-brown outline-none focus:ring-2 focus:ring-terracotta transition-all">
            </div>

            <div class="relative group flex items-center bg-input rounded-2xl focus-within:ring-2 focus-within:ring-terracotta transition-all overflow-hidden">
                 <i class="fa-solid fa-phone absolute left-4 text-brown opacity-60 text-lg group-focus-within:text-terracotta transition-colors z-10"></i>
                 <div class="h-full py-4 flex items-center justify-center pl-12 pr-3 bg-brown/5 text-brown font-bold border-r border-brown/10">+91</div>
                 <input type="tel" id="signupPhone" placeholder="xxxxx xxxxx" maxlength="10" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" class="w-full py-4 px-4 bg-input text-brown font-semibold placeholder-brown outline-none">
            </div>

            <div class="relative group">
                <i class="fa-solid fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-brown opacity-60 text-lg group-focus-within:text-terracotta transition-colors"></i>
                <input type="password" id="signupPassword" placeholder="Create Password" class="w-full py-4 pl-12 pr-4 bg-input rounded-2xl text-brown font-semibold placeholder-brown outline-none focus:ring-2 focus:ring-terracotta transition-all">
            </div>

            <button id="signupBtn" class="w-full py-4 bg-terracotta text-white text-lg font-bold rounded-full shadow-lg mt-4 hover:bg-[#a85a3f] transition transform active:scale-95">
                Sign Up
            </button>

            <p class="text-center text-brown font-semibold mt-2 text-sm">
                Already have an account? <a href="signin.html" class="text-terracotta hover:underline font-bold">Log In</a>
            </p>
        </div>

    </div>

    <script>
        const signupBtn = document.getElementById('signupBtn');
        const messageBox = document.getElementById('messageBox');

        function showMessage(msg, isError = false) {
            messageBox.textContent = msg;
            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            messageBox.classList.add(isError ? 'bg-red-100' : 'bg-green-100');
            messageBox.classList.add(isError ? 'text-red-700' : 'text-green-700');
        }

        signupBtn.addEventListener('click', async () => {
            // 1. Get values and trim whitespace
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();
            const password = document.getElementById('signupPassword').value;

            // 2. Basic Client-side Validation
            if (!name) return showMessage("Full Name is required", true); // New check for name
            if (!email && !phone) return showMessage("Please enter email or phone number", true);
            if (!password) return showMessage("Password is required", true);

            // Gmail Check
            if (email && !email.toLowerCase().endsWith('@gmail.com')) {
                return showMessage("Please use a Gmail address (e.g., name@gmail.com)", true);
            }

            // Phone Validation
            if (phone && phone.length !== 10) {
                return showMessage("Phone number must be exactly 10 digits.", true);
            }

            signupBtn.textContent = 'Signing up...';
            signupBtn.disabled = true;

            try {
                // 3. Call Backend API (Sending name included)
                const response = await fetch('https://cozy-bites.onrender.com/api/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    // Send the name field
                    body: JSON.stringify({ name, email, phone, password })
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage(data.message);
                    setTimeout(() => window.location.href = 'signin.html', 2000);
                } else {
                    showMessage(data.message, true);
                    signupBtn.textContent = 'Sign Up';
                    signupBtn.disabled = false;
                }

            } catch (error) {
                showMessage("Cannot connect to server.", true);
                signupBtn.textContent = 'Sign Up';
                signupBtn.disabled = false;
            }
        });
    </script>
</body>
</html>